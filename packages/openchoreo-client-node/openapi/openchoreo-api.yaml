openapi: 3.0.3
info:
  title: OpenChoreo API
  description: OpenChoreo platform API for managing organizations, projects, components, builds, and deployments
  version: 1.0.0
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: /api/v1
    description: OpenChoreo API Server

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Core response wrapper types
    APIResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          additionalProperties: true
        error:
          type: string
        code:
          type: string

    ListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            type: object
            additionalProperties: true
        totalCount:
          type: integer
        page:
          type: integer
        pageSize:
          type: integer

    ComponentSchemaResponse:
      type: object
      description: Wrapped schema containing component-type and trait environment override schemas
      properties:
        componentTypeEnvOverrides:
          type: object
          description: JSON Schema for component-type environment overrides
          additionalProperties: true
        traitOverrides:
          type: object
          description: Object mapping trait instance names to their JSON Schemas for environment overrides
          additionalProperties:
            type: object
            description: JSON Schema for a specific trait's environment overrides
            additionalProperties: true

    # SecretReference
    SecretReferenceResponse:
      type: object
      required:
        - name
        - namespace
        - createdAt
        - status
      properties:
        name:
          type: string
        namespace:
          type: string
        displayName:
          type: string
        description:
          type: string
        secretStores:
          type: array
          items:
            $ref: '#/components/schemas/SecretStoreReference'
        refreshInterval:
          type: string
          description: Duration string for refresh interval (e.g., "5m", "1h")
        data:
          type: array
          items:
            $ref: '#/components/schemas/SecretDataSourceInfo'
        createdAt:
          type: string
          format: date-time
        lastRefreshTime:
          type: string
          format: date-time
        status:
          type: string

    SecretStoreReference:
      type: object
      required:
        - name
        - namespace
        - kind
      properties:
        name:
          type: string
        namespace:
          type: string
        kind:
          type: string

    SecretDataSourceInfo:
      type: object
      required:
        - secretKey
        - remoteRef
      properties:
        secretKey:
          type: string
        remoteRef:
          $ref: '#/components/schemas/RemoteReferenceInfo'

    RemoteReferenceInfo:
      type: object
      required:
        - key
      properties:
        key:
          type: string
        property:
          type: string
        version:
          type: string

    # Organization
    OrganizationResponse:
      type: object
      required:
        - name
        - createdAt
      properties:
        name:
          type: string
        displayName:
          type: string
        description:
          type: string
        namespace:
          type: string
        createdAt:
          type: string
          format: date-time
        status:
          type: string

    # Project
    ProjectResponse:
      type: object
      required:
        - uid
        - name
        - orgName
        - createdAt
      properties:
        uid:
          type: string # TODO: Make this required with v0.5.0.
        name:
          type: string
        orgName:
          type: string
        displayName:
          type: string
        description:
          type: string
        deploymentPipeline:
          type: string
        createdAt:
          type: string
          format: date-time
        status:
          type: string

    CreateProjectRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        displayName:
          type: string
        description:
          type: string
        deploymentPipeline:
          type: string

    # DeploymentPipeline
    DeploymentPipelineResponse:
      type: object
      required:
        - name
        - orgName
        - createdAt
      properties:
        name:
          type: string
        displayName:
          type: string
        description:
          type: string
        orgName:
          type: string
        createdAt:
          type: string
          format: date-time
        status:
          type: string
        promotionPaths:
          type: array
          items:
            $ref: '#/components/schemas/PromotionPath'

    PromotionPath:
      type: object
      required:
        - sourceEnvironmentRef
        - targetEnvironmentRefs
      properties:
        sourceEnvironmentRef:
          type: string
        targetEnvironmentRefs:
          type: array
          items:
            $ref: '#/components/schemas/TargetEnvironmentRef'

    TargetEnvironmentRef:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        requiresApproval:
          type: boolean
        isManualApprovalRequired:
          type: boolean

    # Component
    ComponentResponse:
      type: object
      required:
        - uid
        - name
        - type
        - projectName
        - orgName
        - createdAt
      properties:
        uid:
          type: string # TODO: Make this required with v0.5.0.
        name:
          type: string
        displayName:
          type: string
        description:
          type: string
        type:
          type: string
        projectName:
          type: string
        orgName:
          type: string
        createdAt:
          type: string
          format: date-time
        status:
          type: string
        autoDeploy:
          type: boolean
        service:
          type: object
          additionalProperties: true
        webApplication:
          type: object
          additionalProperties: true
        scheduledTask:
          type: object
          additionalProperties: true
        api:
          type: object
          additionalProperties: true
        workload:
          type: object
          additionalProperties: true
        componentWorkflow:
          $ref: '#/components/schemas/ComponentWorkflow'

    CreateComponentRequest:
      type: object
      required:
        - name
        - type
      properties:
        name:
          type: string
        displayName:
          type: string
        description:
          type: string
        type:
          type: string
        workflow:
          $ref: '#/components/schemas/ComponentWorkflow'

    PatchComponentRequest:
      type: object
      properties:
        autoDeploy:
          type: boolean
          description: Controls whether the component should automatically deploy to the default environment

    # Component Traits
    ComponentTraitResponse:
      type: object
      required:
        - name
        - instanceName
      properties:
        name:
          type: string
          description: Name of the Trait resource
        instanceName:
          type: string
          description: Unique instance name for this trait within the component
        parameters:
          type: object
          description: Trait parameter values
          additionalProperties: true

    ComponentTraitRequest:
      type: object
      required:
        - name
        - instanceName
      properties:
        name:
          type: string
          description: Name of the Trait resource to use
        instanceName:
          type: string
          description: Unique instance name for this trait within the component
        parameters:
          type: object
          description: Trait parameter values
          additionalProperties: true

    UpdateComponentTraitsRequest:
      type: object
      required:
        - traits
      properties:
        traits:
          type: array
          description: Array of trait instances to attach to the component (replaces all existing traits)
          items:
            $ref: '#/components/schemas/ComponentTraitRequest'

    # Environment
    EnvironmentResponse:
      type: object
      required:
        - uid
        - name
        - namespace
        - isProduction
        - createdAt
      properties:
        uid:
          type: string # TODO: Make this required with v0.5.0.
        name:
          type: string
        namespace:
          type: string
        displayName:
          type: string
        description:
          type: string
        dataPlaneRef:
          type: string
        isProduction:
          type: boolean
        dnsPrefix:
          type: string
        createdAt:
          type: string
          format: date-time
        status:
          type: string

    CreateEnvironmentRequest:
      type: object
      required:
        - name
        - isProduction
      properties:
        name:
          type: string
        displayName:
          type: string
        description:
          type: string
        dataPlaneRef:
          type: string
        isProduction:
          type: boolean
        dnsPrefix:
          type: string

    # DataPlane
    DataPlaneResponse:
      type: object
      required:
        - name
        - namespace
        - kubernetesClusterName
        - apiServerURL
        - publicVirtualHost
        - organizationVirtualHost
        - createdAt
      properties:
        name:
          type: string
        namespace:
          type: string
        displayName:
          type: string
        description:
          type: string
        imagePullSecretRefs:
          type: array
          items:
            type: string
        secretStoreRef:
          type: string
        kubernetesClusterName:
          type: string
        apiServerURL:
          type: string
        publicVirtualHost:
          type: string
        organizationVirtualHost:
          type: string
        observerURL:
          type: string
        observerUsername:
          type: string
        createdAt:
          type: string
          format: date-time
        status:
          type: string

    CreateDataPlaneRequest:
      type: object
      required:
        - name
        - kubernetesClusterName
        - apiServerURL
        - caCert
        - clientCert
        - clientKey
        - publicVirtualHost
        - organizationVirtualHost
      properties:
        name:
          type: string
        displayName:
          type: string
        description:
          type: string
        kubernetesClusterName:
          type: string
        apiServerURL:
          type: string
        caCert:
          type: string
        clientCert:
          type: string
        clientKey:
          type: string
        publicVirtualHost:
          type: string
        organizationVirtualHost:
          type: string
        observerURL:
          type: string
        observerUsername:
          type: string
        observerPassword:
          type: string

    # BuildPlane
    BuildPlaneResponse:
      type: object
      required:
        - name
        - namespace
        - kubernetesClusterName
        - apiServerURL
        - createdAt
      properties:
        name:
          type: string
        namespace:
          type: string
        displayName:
          type: string
        description:
          type: string
        kubernetesClusterName:
          type: string
        apiServerURL:
          type: string
        observerURL:
          type: string
        observerUsername:
          type: string
        createdAt:
          type: string
          format: date-time
        status:
          type: string

    # Build
    BuildResponse:
      type: object
      required:
        - name
        - uuid
        - componentName
        - projectName
        - orgName
        - createdAt
      properties:
        name:
          type: string
        uuid:
          type: string
        componentName:
          type: string
        projectName:
          type: string
        orgName:
          type: string
        commit:
          type: string
        status:
          type: string
        createdAt:
          type: string
          format: date-time
        image:
          type: string

    # BuildTemplate
    BuildTemplateResponse:
      type: object
      required:
        - name
        - createdAt
      properties:
        name:
          type: string
        parameters:
          type: array
          items:
            $ref: '#/components/schemas/BuildTemplateParameter'
        createdAt:
          type: string
          format: date-time

    BuildTemplateParameter:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        default:
          type: string

    # ComponentType
    ComponentTypeResponse:
      type: object
      required:
        - name
        - workloadType
        - createdAt
      properties:
        name:
          type: string
        displayName:
          type: string
        description:
          type: string
        workloadType:
          type: string
        allowedWorkflows:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time

    # Workflow
    WorkflowResponse:
      type: object
      required:
        - name
        - createdAt
      properties:
        name:
          type: string
        displayName:
          type: string
        description:
          type: string
        createdAt:
          type: string
          format: date-time

    # ComponentWorkflowRun
    ComponentWorkflowRunResponse:
      type: object
      required:
        - name
        - uuid
        - componentName
        - projectName
        - orgName
        - createdAt
      properties:
        name:
          type: string
        uuid:
          type: string
        componentName:
          type: string
        projectName:
          type: string
        orgName:
          type: string
        commit:
          type: string
        status:
          type: string
        createdAt:
          type: string
          format: date-time
        image:
          type: string
        workflow:
          $ref: '#/components/schemas/ComponentWorkflowConfigResponse'

    # ComponentWorkflowConfig
    ComponentWorkflowConfigResponse:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        systemParameters:
          $ref: '#/components/schemas/SystemParametersResponse'
        parameters:
          type: object
          additionalProperties: true
          description: Developer-defined workflow parameters as arbitrary JSON

    # SystemParameters
    SystemParametersResponse:
      type: object
      properties:
        repository:
          $ref: '#/components/schemas/RepositoryResponse'

    # Repository
    RepositoryResponse:
      type: object
      required:
        - url
        - appPath
      properties:
        url:
          type: string
        appPath:
          type: string
        revision:
          $ref: '#/components/schemas/RepositoryRevisionResponse'

    # RepositoryRevision
    RepositoryRevisionResponse:
      type: object
      required:
        - branch
      properties:
        branch:
          type: string
        commit:
          type: string

    # Trait
    TraitResponse:
      type: object
      required:
        - name
        - createdAt
      properties:
        name:
          type: string
        displayName:
          type: string
        description:
          type: string
        createdAt:
          type: string
          format: date-time

    # Binding
    BindingResponse:
      type: object
      required:
        - name
        - type
        - componentName
        - projectName
        - orgName
        - environment
        - status
      properties:
        name:
          type: string
        type:
          type: string
        componentName:
          type: string
        projectName:
          type: string
        orgName:
          type: string
        environment:
          type: string
        status:
          $ref: '#/components/schemas/BindingStatus'
        serviceBinding:
          $ref: '#/components/schemas/ServiceBinding'
        webApplicationBinding:
          $ref: '#/components/schemas/WebApplicationBinding'
        scheduledTaskBinding:
          $ref: '#/components/schemas/ScheduledTaskBinding'

    BindingStatus:
      type: object
      required:
        - reason
        - message
        - status
        - lastTransitioned
      properties:
        reason:
          type: string
        message:
          type: string
        status:
          type: string
          enum: [InProgress, Active, Failed, Suspended, NotYetDeployed]
        lastTransitioned:
          type: string
          format: date-time

    ServiceBinding:
      type: object
      properties:
        endpoints:
          type: array
          items:
            $ref: '#/components/schemas/EndpointStatus'
        image:
          type: string
        releaseState:
          type: string

    WebApplicationBinding:
      type: object
      properties:
        endpoints:
          type: array
          items:
            $ref: '#/components/schemas/EndpointStatus'
        image:
          type: string
        releaseState:
          type: string

    ScheduledTaskBinding:
      type: object
      properties:
        image:
          type: string
        releaseState:
          type: string

    EndpointStatus:
      type: object
      required:
        - name
        - type
      properties:
        name:
          type: string
        type:
          type: string
        project:
          $ref: '#/components/schemas/ExposedEndpoint'
        organization:
          $ref: '#/components/schemas/ExposedEndpoint'
        public:
          $ref: '#/components/schemas/ExposedEndpoint'

    ExposedEndpoint:
      type: object
      required:
        - host
        - port
      properties:
        host:
          type: string
        port:
          type: integer
        scheme:
          type: string
        basePath:
          type: string
        uri:
          type: string

    UpdateBindingRequest:
      type: object
      required:
        - releaseState
      properties:
        releaseState:
          type: string
          enum: [Active, Suspend, Undeploy]

    # Promotion
    PromoteComponentRequest:
      type: object
      required:
        - sourceEnv
        - targetEnv
      properties:
        sourceEnv:
          type: string
        targetEnv:
          type: string

    # Workload
    WorkloadResponse:
      type: object
      properties:
        name:
          type: string
        type:
          type: string
          enum:
            - Service
            - ManualTask
            - ScheduledTask
            - WebApplication
          description: The workload type determines how the workload is deployed
        owner:
          $ref: '#/components/schemas/WorkloadOwner'
        metadata:
          type: object
          additionalProperties: true
        spec:
          type: object
          additionalProperties: true
        containers:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/Container'
        endpoints:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/WorkloadEndpoint'
        connections:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/Connection'

    ComponentWorkflow:
      type: object
      required:
        - name
        - systemParameters
      properties:
        name:
          type: string
        systemParameters:
          $ref: '#/components/schemas/ComponentWorkflowSystemParams'
        parameters:
          type: object
          additionalProperties: true
          description: Developer-defined workflow parameters as arbitrary JSON

    # Observer URL
    ObserverUrlData:
      type: object
      properties:
        observerUrl:
          type: string

    # ComponentRelease
    ComponentReleaseResponse:
      type: object
      description: |
        Immutable snapshot of component configuration.
        Note: The following fields are immutable after creation and cannot be modified:
        - componentType
        - traits
        - componentProfile
        - workload
      required:
        - name
        - componentName
        - projectName
        - orgName
        - createdAt
      properties:
        name:
          type: string
        componentName:
          type: string
        projectName:
          type: string
        orgName:
          type: string
        createdAt:
          type: string
          format: date-time
        status:
          type: string

    CreateComponentReleaseRequest:
      type: object
      properties:
        releaseName:
          type: string

    # ReleaseBinding
    ReleaseBindingResponse:
      type: object
      required:
        - name
        - componentName
        - projectName
        - orgName
        - environment
        - releaseName
        - createdAt
      properties:
        name:
          type: string
        componentName:
          type: string
        projectName:
          type: string
        orgName:
          type: string
        environment:
          type: string
        releaseName:
          type: string
        componentTypeEnvOverrides:
          type: object
          additionalProperties: true
        traitOverrides:
          type: object
          additionalProperties: true
        workloadOverrides:
          $ref: '#/components/schemas/WorkloadOverrides'
        createdAt:
          type: string
          format: date-time
        status:
          type: string

    PatchReleaseBindingRequest:
      type: object
      properties:
        releaseName:
          type: string
        environment:
          type: string
        componentTypeEnvOverrides:
          type: object
          additionalProperties: true
        traitOverrides:
          type: object
          additionalProperties: true
        workloadOverrides:
          $ref: '#/components/schemas/WorkloadOverrides'

    WorkloadOverrides:
      type: object
      properties:
        containers:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/ContainerOverride'

    ContainerOverride:
      type: object
      properties:
        env:
          type: array
          items:
            $ref: '#/components/schemas/EnvVar'
        files:
          type: array
          items:
            $ref: '#/components/schemas/FileVar'

    FileVar:
      type: object
      required:
        - key
        - mountPath
      properties:
        key:
          type: string
        mountPath:
          type: string
        value:
          type: string
        valueFrom:
          $ref: '#/components/schemas/EnvVarValueFrom'

    DeployReleaseRequest:
      type: object
      required:
        - releaseName
      properties:
        releaseName:
          type: string

    EnvVar:
      type: object
      required:
        - key
      properties:
        key:
          type: string
        value:
          type: string
        valueFrom:
          $ref: '#/components/schemas/EnvVarValueFrom'

    EnvVarValueFrom:
      type: object
      properties:
        secretRef:
          $ref: '#/components/schemas/SecretKeyRef'

    SecretKeyRef:
      type: object
      required:
        - name
        - key
      properties:
        name:
          type: string
        key:
          type: string

    Container:
      type: object
      required:
        - image
      properties:
        image:
          type: string
        command:
          type: array
          items:
            type: string
        args:
          type: array
          items:
            type: string
        env:
          type: array
          items:
            $ref: '#/components/schemas/EnvVar'

    WorkloadEndpoint:
      type: object
      required:
        - type
        - port
      properties:
        type:
          type: string
          enum: ['TCP', 'UDP', 'HTTP', 'REST', 'gRPC', 'Websocket', 'GraphQL']
        port:
          type: integer
        schema:
          $ref: '#/components/schemas/Schema'

    Connection:
      type: object
      required:
        - params
        - type
      properties:
        inject:
          $ref: '#/components/schemas/ConnectionInject'
        params:
          $ref: '#/components/schemas/ConnectionParams'
        type:
          type: string

    WorkloadOwner:
      type: object
      required:
        - projectName
        - componentName
      properties:
        projectName:
          type: string
        componentName:
          type: string

    ConnectionParams:
      type: object
      required:
        - componentName
        - endpoint
        - projectName
      properties:
        componentName:
          type: string
        endpoint:
          type: string
        projectName:
          type: string

    ConnectionInject:
      type: object
      properties:
        env:
          type: array
          items:
            $ref: '#/components/schemas/ConnectionInjectEnv'

    ConnectionInjectEnv:
      type: object
      required:
        - name
        - value
      properties:
        name:
          type: string
        value:
          type: string

    Schema:
      type: object
      properties:
        type:
          type: string
        content:
          type: string

    # Release (deployed state in environment)
    ReleaseResponse:
      type: object
      required:
        - spec
        - status
      properties:
        spec:
          $ref: '#/components/schemas/ReleaseSpec'
        status:
          $ref: '#/components/schemas/ReleaseStatus'

    ReleaseSpec:
      type: object
      required:
        - owner
        - environmentName
      properties:
        owner:
          $ref: '#/components/schemas/ReleaseOwner'
        environmentName:
          type: string
          minLength: 1
        resources:
          type: array
          items:
            $ref: '#/components/schemas/Resource'
        interval:
          type: string
          pattern: '^([0-9]+(\.[0-9]+)?(ms|s|m|h))+$'
          description: Watch interval for release resources when stable (default 5m)
        progressingInterval:
          type: string
          pattern: '^([0-9]+(\.[0-9]+)?(ms|s|m|h))+$'
          description: Watch interval for release resources when transitioning (default 10s)

    ReleaseStatus:
      type: object
      properties:
        resources:
          type: array
          items:
            $ref: '#/components/schemas/ResourceStatus'
        conditions:
          type: array
          items:
            $ref: '#/components/schemas/Condition'

    ReleaseOwner:
      type: object
      required:
        - projectName
        - componentName
      properties:
        projectName:
          type: string
          minLength: 1
        componentName:
          type: string
          minLength: 1

    Resource:
      type: object
      required:
        - id
        - object
      properties:
        id:
          type: string
          minLength: 1
          description: Unique identifier for the resource
        object:
          type: object
          description: Complete Kubernetes resource definition
          additionalProperties: true

    ResourceStatus:
      type: object
      required:
        - id
        - version
        - kind
        - name
      properties:
        id:
          type: string
          minLength: 1
        group:
          type: string
          description: API group of the resource (empty for core resources)
        version:
          type: string
          minLength: 1
        kind:
          type: string
          minLength: 1
        name:
          type: string
          minLength: 1
        namespace:
          type: string
          description: Namespace (empty for cluster-scoped resources)
        status:
          type: object
          additionalProperties: true
          description: Entire .status field of the resource
        healthStatus:
          type: string
          enum:
            - Unknown
            - Progressing
            - Healthy
            - Suspended
            - Degraded
        lastObservedTime:
          type: string
          format: date-time

    Condition:
      type: object
      required:
        - type
        - status
        - lastTransitionTime
      properties:
        type:
          type: string
        status:
          type: string
          enum:
            - 'True'
            - 'False'
            - Unknown
        observedGeneration:
          type: integer
          format: int64
        lastTransitionTime:
          type: string
          format: date-time
        reason:
          type: string
        message:
          type: string

    # Request schemas
    UpdateComponentWorkflowRequest:
      type: object
      properties:
        workflowName:
          type: string
          description: Name of the workflow to initialize (optional, required for initialization)
        systemParameters:
          $ref: '#/components/schemas/ComponentWorkflowSystemParams'
        parameters:
          type: object
          additionalProperties: true
          description: Developer-defined workflow parameters as arbitrary JSON

    ComponentWorkflowSystemParams:
      type: object
      required:
        - repository
      properties:
        repository:
          $ref: '#/components/schemas/ComponentWorkflowRepository'

    ComponentWorkflowRepository:
      type: object
      required:
        - url
        - revision
      properties:
        url:
          type: string
        revision:
          $ref: '#/components/schemas/ComponentWorkflowRepositoryRevision'
        appPath:
          type: string

    ComponentWorkflowRepositoryRevision:
      type: object
      required:
        - branch
      properties:
        branch:
          type: string
        commit:
          type: string

    # Authorization types
    SubjectType:
      type: string
      enum:
        - user
        - service_account

    PolicyEffectType:
      type: string
      enum:
        - allow
        - deny

    Entitlement:
      type: object
      required:
        - claim
        - value
      properties:
        claim:
          type: string
        value:
          type: string

    AuthzResourceHierarchy:
      type: object
      properties:
        organization:
          type: string
        organization_units:
          type: array
          items:
            type: string
        project:
          type: string
        component:
          type: string

    Role:
      type: object
      required:
        - name
        - actions
      properties:
        name:
          type: string
        actions:
          type: array
          items:
            type: string

    RoleEntitlementMapping:
      type: object
      required:
        - role_name
        - entitlement
        - hierarchy
        - effect
      properties:
        id:
          type: integer
          description: Unique identifier for the mapping
        role_name:
          type: string
        entitlement:
          $ref: '#/components/schemas/Entitlement'
        hierarchy:
          $ref: '#/components/schemas/AuthzResourceHierarchy'
        effect:
          $ref: '#/components/schemas/PolicyEffectType'
        context:
          type: object

    UpdateRoleRequest:
      type: object
      required:
        - actions
      properties:
        actions:
          type: array
          items:
            type: string
          description: List of actions to assign to the role

    EntitlementConfig:
      type: object
      required:
        - claim
        - display_name
      properties:
        claim:
          type: string
        display_name:
          type: string

    AuthMechanismConfig:
      type: object
      required:
        - type
        - entitlement
      properties:
        type:
          type: string
          description: Authentication mechanism type (e.g., "jwt", "oauth2", "api_key")
        entitlement:
          $ref: '#/components/schemas/EntitlementConfig'

    UserTypeConfig:
      type: object
      required:
        - type
        - display_name
        - priority
        - auth_mechanisms
      properties:
        type:
          $ref: '#/components/schemas/SubjectType'
        display_name:
          type: string
        priority:
          type: integer
        auth_mechanisms:
          type: array
          items:
            $ref: '#/components/schemas/AuthMechanismConfig'

    Subject:
      type: object
      required:
        - jwt_token
      properties:
        jwt_token:
          type: string

    AuthzResource:
      type: object
      required:
        - type
        - hierarchy
      properties:
        type:
          type: string
        id:
          type: string
        hierarchy:
          $ref: '#/components/schemas/AuthzResourceHierarchy'

    EvaluateRequest:
      type: object
      required:
        - subject
        - resource
        - action
      properties:
        subject:
          $ref: '#/components/schemas/Subject'
        resource:
          $ref: '#/components/schemas/AuthzResource'
        action:
          type: string
        context:
          type: object

    BatchEvaluateRequest:
      type: object
      required:
        - requests
      properties:
        requests:
          type: array
          items:
            $ref: '#/components/schemas/EvaluateRequest'

    DecisionContext:
      type: object
      properties:
        reason:
          type: string

    Decision:
      type: object
      required:
        - decision
      properties:
        decision:
          type: boolean
        context:
          $ref: '#/components/schemas/DecisionContext'

    BatchEvaluateResponse:
      type: object
      required:
        - decisions
      properties:
        decisions:
          type: array
          items:
            $ref: '#/components/schemas/Decision'

    CapabilityResource:
      type: object
      required:
        - path
      properties:
        path:
          type: string
        constraints:
          type: object

    ActionCapability:
      type: object
      properties:
        allowed:
          type: array
          items:
            $ref: '#/components/schemas/CapabilityResource'
        denied:
          type: array
          items:
            $ref: '#/components/schemas/CapabilityResource'

    SubjectContext:
      type: object
      properties:
        Type:
          $ref: '#/components/schemas/SubjectType'
        EntitlementClaim:
          type: string
        EntitlementValues:
          type: array
          items:
            type: string

    UserCapabilitiesResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/SubjectContext'
        capabilities:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/ActionCapability'
        evaluatedAt:
          type: string
          format: date-time

security:
  - BearerAuth: []

paths:
  # Health check
  /health:
    get:
      summary: Health check endpoint
      operationId: health
      tags:
        - Health
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            text/plain:
              schema:
                type: string

  /ready:
    get:
      summary: Readiness check endpoint
      operationId: ready
      tags:
        - Health
      security: []
      responses:
        '200':
          description: Service is ready
          content:
            text/plain:
              schema:
                type: string

  # Apply/Delete operations (kubectl-like)
  /apply:
    post:
      summary: Apply a resource (kubectl-like)
      operationId: applyResource
      tags:
        - Resources
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: Kubernetes-style resource definition
              additionalProperties: true
      responses:
        '200':
          description: Resource applied successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResponse'
        '201':
          description: Resource created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResponse'

  /delete:
    delete:
      summary: Delete a resource (kubectl-like)
      operationId: deleteResource
      tags:
        - Resources
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: Kubernetes-style resource definition
              additionalProperties: true
      responses:
        '200':
          description: Resource deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResponse'

  # Organizations
  /orgs:
    get:
      summary: List all organizations
      operationId: listOrganizations
      tags:
        - Organizations
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/OrganizationResponse'

  /orgs/{orgName}:
    get:
      summary: Get a specific organization
      operationId: getOrganization
      tags:
        - Organizations
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/OrganizationResponse'

  /orgs/{orgName}/secret-references:
    get:
      summary: List secret references for an organization
      operationId: listSecretReferences
      tags:
        - Organizations
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/SecretReferenceResponse'
        '404':
          description: Organization not found

  # DataPlanes
  /orgs/{orgName}/dataplanes:
    get:
      summary: List all data planes
      operationId: listDataPlanes
      tags:
        - DataPlanes
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/DataPlaneResponse'

    post:
      summary: Create a new data plane
      operationId: createDataPlane
      tags:
        - DataPlanes
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDataPlaneRequest'
      responses:
        '201':
          description: Data plane created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DataPlaneResponse'

  /orgs/{orgName}/dataplanes/{dpName}:
    get:
      summary: Get a specific data plane
      operationId: getDataPlane
      tags:
        - DataPlanes
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: dpName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DataPlaneResponse'

  # Environments
  /orgs/{orgName}/environments:
    get:
      summary: List all environments
      operationId: listEnvironments
      tags:
        - Environments
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/EnvironmentResponse'

    post:
      summary: Create a new environment
      operationId: createEnvironment
      tags:
        - Environments
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEnvironmentRequest'
      responses:
        '201':
          description: Environment created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/EnvironmentResponse'

  /orgs/{orgName}/environments/{envName}:
    get:
      summary: Get a specific environment
      operationId: getEnvironment
      tags:
        - Environments
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: envName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/EnvironmentResponse'

  # BuildPlanes
  /orgs/{orgName}/buildplanes:
    get:
      summary: List build planes
      operationId: listBuildPlanes
      tags:
        - BuildPlanes
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/BuildPlaneResponse'

  # ComponentTypes
  /orgs/{orgName}/component-types:
    get:
      summary: List all component types for an organization
      operationId: listComponentTypes
      tags:
        - ComponentTypes
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/ComponentTypeResponse'

  /orgs/{orgName}/component-types/{ctName}/schema:
    get:
      summary: Get the JSON schema for a specific component type
      operationId: getComponentTypeSchema
      tags:
        - ComponentTypes
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: ctName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        description: JSON Schema for the component type
                        additionalProperties: true
        '404':
          description: Component type not found

  # Workflows (generic workflows)
  /orgs/{orgName}/workflows:
    get:
      summary: List all workflows for an organization
      operationId: listWorkflows
      tags:
        - Workflows
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/WorkflowResponse'

  /orgs/{orgName}/workflows/{workflowName}/schema:
    get:
      summary: Get the JSON schema for a specific workflow
      operationId: getWorkflowSchema
      tags:
        - Workflows
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: workflowName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        description: JSON Schema for the workflow
                        additionalProperties: true
        '404':
          description: Workflow not found

  # ComponentWorkflows (component-specific workflows)
  /orgs/{orgName}/component-workflows:
    get:
      summary: List all component workflows for an organization
      operationId: listComponentWorkflows
      tags:
        - ComponentWorkflows
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/WorkflowResponse'

  /orgs/{orgName}/component-workflows/{cwName}/schema:
    get:
      summary: Get the JSON schema for a specific component workflow
      operationId: getComponentWorkflowSchema
      tags:
        - ComponentWorkflows
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: cwName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        description: JSON Schema for the component workflow
                        additionalProperties: true
        '404':
          description: Component workflow not found

  # Traits
  /orgs/{orgName}/traits:
    get:
      summary: List all traits for an organization
      operationId: listTraits
      tags:
        - Traits
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/TraitResponse'

  /orgs/{orgName}/traits/{traitName}/schema:
    get:
      summary: Get the JSON schema for a specific trait
      operationId: getTraitSchema
      tags:
        - Traits
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: traitName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        description: JSON Schema for the trait
                        additionalProperties: true
        '404':
          description: Trait not found

  # Projects
  /orgs/{orgName}/projects:
    get:
      summary: List all projects in an organization
      operationId: listProjects
      tags:
        - Projects
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/ProjectResponse'

    post:
      summary: Create a new project
      operationId: createProject
      tags:
        - Projects
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectRequest'
      responses:
        '201':
          description: Project created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ProjectResponse'

  /orgs/{orgName}/projects/{projectName}:
    get:
      summary: Get a specific project
      operationId: getProject
      tags:
        - Projects
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ProjectResponse'

  /orgs/{orgName}/projects/{projectName}/deployment-pipeline:
    get:
      summary: Get project deployment pipeline
      operationId: getProjectDeploymentPipeline
      tags:
        - Projects
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DeploymentPipelineResponse'

  # Components
  /orgs/{orgName}/projects/{projectName}/components:
    get:
      summary: List all components in a project
      operationId: listComponents
      tags:
        - Components
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/ComponentResponse'

    post:
      summary: Create a new component
      operationId: createComponent
      tags:
        - Components
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateComponentRequest'
      responses:
        '201':
          description: Component created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ComponentResponse'

  /orgs/{orgName}/projects/{projectName}/components/{componentName}:
    get:
      summary: Get a specific component
      operationId: getComponent
      tags:
        - Components
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
        - name: include
          in: query
          required: false
          schema:
            type: string
            description: Comma-separated list of additional resources to include (e.g., "type,workload")
          description: Additional resources to include in the response. Valid values are "type" and "workload".
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ComponentResponse'
    patch:
      summary: Patch a component
      operationId: patchComponent
      tags:
        - Components
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchComponentRequest'
      responses:
        '200':
          description: Component successfully patched
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ComponentResponse'
        '400':
          description: Bad request - invalid input
        '404':
          description: Component or project not found
        '500':
          description: Internal server error

  /orgs/{orgName}/projects/{projectName}/components/{componentName}/schema:
    get:
      summary: Get the JSON schema for a specific component
      operationId: getComponentSchema
      tags:
        - Components
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ComponentSchemaResponse'
        '404':
          description: Component not found

  /orgs/{orgName}/projects/{projectName}/components/{componentName}/traits:
    get:
      summary: List all traits attached to a component
      operationId: listComponentTraits
      tags:
        - Components
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ListResponse'
                      totalCount:
                        type: integer
                      page:
                        type: integer
                      pageSize:
                        type: integer
        '400':
          description: Bad request
        '403':
          description: Forbidden
        '404':
          description: Component not found

    put:
      summary: Update all traits on a component
      operationId: updateComponentTraits
      tags:
        - Components
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateComponentTraitsRequest'
      responses:
        '200':
          description: Traits updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ListResponse'
                      totalCount:
                        type: integer
                      page:
                        type: integer
                      pageSize:
                        type: integer
        '400':
          description: Bad request
        '403':
          description: Forbidden
        '404':
          description: Component or trait not found

  /orgs/{orgName}/projects/{projectName}/components/{componentName}/workflow-parameters:
    patch:
      summary: Update component workflow parameters
      operationId: updateComponentWorkflowParameters
      tags:
        - ComponentWorkflows
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateComponentWorkflowRequest'
      responses:
        '200':
          description: Workflow parameters updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ComponentResponse'

  /orgs/{orgName}/projects/{projectName}/components/{componentName}/workflow-runs:
    post:
      summary: Create a component workflow run
      operationId: createComponentWorkflowRun
      tags:
        - ComponentWorkflows
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
        - name: commit
          in: query
          required: false
          schema:
            type: string
          description: Git commit SHA (7-40 hexadecimal characters)
      responses:
        '201':
          description: Component workflow run created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ComponentWorkflowRunResponse'
        '400':
          description: Invalid commit SHA format

    get:
      summary: List component workflow runs
      operationId: listComponentWorkflowRuns
      tags:
        - ComponentWorkflows
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/ComponentWorkflowRunResponse'

  /orgs/{orgName}/projects/{projectName}/components/{componentName}/workflow-runs/{runName}:
    get:
      summary: Get a specific component workflow run
      operationId: getComponentWorkflowRun
      tags:
        - ComponentWorkflows
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
        - name: runName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ComponentWorkflowRunResponse'
        '404':
          description: Component workflow run not found

  # Component Bindings
  /orgs/{orgName}/projects/{projectName}/components/{componentName}/bindings:
    get:
      summary: Get component bindings
      operationId: getComponentBinding
      tags:
        - Bindings
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/BindingResponse'

  /orgs/{orgName}/projects/{projectName}/components/{componentName}/bindings/{bindingName}:
    patch:
      summary: Update a component binding
      operationId: updateComponentBinding
      tags:
        - Bindings
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
        - name: bindingName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBindingRequest'
      responses:
        '200':
          description: Binding updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResponse'

  # Component Releases
  /orgs/{orgName}/projects/{projectName}/components/{componentName}/component-releases:
    get:
      summary: List component releases
      operationId: listComponentReleases
      tags:
        - Releases
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/ComponentReleaseResponse'

    post:
      summary: Create a component release
      operationId: createComponentRelease
      tags:
        - Releases
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateComponentReleaseRequest'
      responses:
        '201':
          description: Component release created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ComponentReleaseResponse'

  /orgs/{orgName}/projects/{projectName}/components/{componentName}/component-releases/{releaseName}:
    get:
      summary: Get a specific component release
      operationId: getComponentRelease
      tags:
        - Releases
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
        - name: releaseName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ComponentReleaseResponse'

  /orgs/{orgName}/projects/{projectName}/components/{componentName}/component-releases/{releaseName}/schema:
    get:
      summary: Get the JSON schema for a specific component release
      operationId: getComponentReleaseSchema
      tags:
        - Releases
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
        - name: releaseName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ComponentSchemaResponse'
        '404':
          description: Component release not found

  # Release Bindings
  /orgs/{orgName}/projects/{projectName}/components/{componentName}/release-bindings:
    get:
      summary: List release bindings
      operationId: listReleaseBindings
      tags:
        - Releases
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/ReleaseBindingResponse'

  /orgs/{orgName}/projects/{projectName}/components/{componentName}/release-bindings/{bindingName}:
    patch:
      summary: Patch a release binding
      operationId: patchReleaseBinding
      tags:
        - Releases
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
        - name: bindingName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchReleaseBindingRequest'
      responses:
        '200':
          description: Release binding updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResponse'

  # Component Deployment
  /orgs/{orgName}/projects/{projectName}/components/{componentName}/deploy:
    post:
      summary: Deploy a release to the lowest environment
      operationId: deployRelease
      tags:
        - Deployment
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeployReleaseRequest'
      responses:
        '200':
          description: Release deployed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResponse'

  # Component Promotion
  /orgs/{orgName}/projects/{projectName}/components/{componentName}/promote:
    post:
      summary: Promote component to environment
      operationId: promoteComponent
      tags:
        - Deployment
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PromoteComponentRequest'
      responses:
        '200':
          description: Component promoted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/ListResponse'
                          - type: object
                            properties:
                              items:
                                type: array
                                items:
                                  $ref: '#/components/schemas/BindingResponse'

  # Observer URLs
  /orgs/{orgName}/projects/{projectName}/components/{componentName}/environments/{environmentName}/observer-url:
    get:
      summary: Get runtime logs observer URL
      operationId: getComponentObserverURL
      tags:
        - Observability
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
        - name: environmentName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ObserverUrlData'

  /orgs/{orgName}/projects/{projectName}/components/{componentName}/observer-url:
    get:
      summary: Get build logs observer URL
      operationId: getBuildObserverURL
      tags:
        - Observability
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ObserverUrlData'

  /orgs/{orgName}/projects/{projectName}/components/{componentName}/environments/{environmentName}/release:
    get:
      summary: Get environment release
      operationId: getEnvironmentRelease
      tags:
        - Releases
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
        - name: environmentName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ReleaseResponse'
        '404':
          description: Release not found for the specified environment

  # Workloads
  /orgs/{orgName}/projects/{projectName}/components/{componentName}/workloads:
    post:
      summary: Create or update workload
      operationId: createWorkload
      tags:
        - Workloads
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: Workload specification
              additionalProperties: true
      responses:
        '200':
          description: Workload created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WorkloadResponse'

    get:
      summary: Get workload for component
      operationId: getWorkloads
      tags:
        - Workloads
      parameters:
        - name: orgName
          in: path
          required: true
          schema:
            type: string
        - name: projectName
          in: path
          required: true
          schema:
            type: string
        - name: componentName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WorkloadResponse'

  # Authorization endpoints
  /authz/roles:
    get:
      summary: List all roles
      operationId: listRoles
      tags:
        - Authorization
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Role'
    post:
      summary: Create a new role
      operationId: addRole
      tags:
        - Authorization
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Role'
      responses:
        '201':
          description: Role created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResponse'
        '409':
          description: Role already exists

  /authz/roles/{roleName}:
    get:
      summary: Get a specific role
      operationId: getRole
      tags:
        - Authorization
      parameters:
        - name: roleName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Role'
        '404':
          description: Role not found
    put:
      summary: Update a role
      operationId: updateRole
      tags:
        - Authorization
      parameters:
        - name: roleName
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRoleRequest'
      responses:
        '200':
          description: Role updated
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Role'
        '404':
          description: Role not found
    delete:
      summary: Delete a role
      operationId: removeRole
      tags:
        - Authorization
      parameters:
        - name: roleName
          in: path
          required: true
          schema:
            type: string
        - name: force
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: If true, force delete the role and all associated mappings
      responses:
        '204':
          description: Role deleted
        '404':
          description: Role not found
        '409':
          description: Role is in use by role mappings (use force=true to delete anyway)

  /authz/role-mappings:
    get:
      summary: List all role-entitlement mappings
      operationId: listRoleMappings
      tags:
        - Authorization
      parameters:
        - name: role
          in: query
          required: false
          schema:
            type: string
          description: Filter mappings by role name
        - name: claim
          in: query
          required: false
          schema:
            type: string
          description: Filter mappings by entitlement claim (must be used with value)
        - name: value
          in: query
          required: false
          schema:
            type: string
          description: Filter mappings by entitlement value (must be used with claim)
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/RoleEntitlementMapping'
    post:
      summary: Create a new role-entitlement mapping
      operationId: addRoleMapping
      tags:
        - Authorization
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleEntitlementMapping'
      responses:
        '201':
          description: Mapping created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIResponse'
        '409':
          description: Mapping already exists

  /authz/role-mappings/{mappingId}:
    put:
      summary: Update a role-entitlement mapping
      operationId: updateRoleMapping
      tags:
        - Authorization
      parameters:
        - name: mappingId
          in: path
          required: true
          schema:
            type: integer
          description: The unique identifier of the mapping to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleEntitlementMapping'
      responses:
        '200':
          description: Mapping updated
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/RoleEntitlementMapping'
        '404':
          description: Mapping not found
        '409':
          description: Mapping conflict
    delete:
      summary: Remove a role-entitlement mapping
      operationId: removeRoleMapping
      tags:
        - Authorization
      parameters:
        - name: mappingId
          in: path
          required: true
          schema:
            type: integer
          description: The unique identifier of the mapping to delete
      responses:
        '204':
          description: Mapping deleted
        '404':
          description: Mapping not found

  /authz/actions:
    get:
      summary: List all available actions
      operationId: listActions
      tags:
        - Authorization
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: string

  /user-types:
    get:
      summary: List all configured user types
      operationId: listUserTypes
      tags:
        - Configuration
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/UserTypeConfig'

  /authz/evaluate:
    post:
      summary: Evaluate a single authorization request
      operationId: evaluate
      tags:
        - Authorization
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EvaluateRequest'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Decision'

  /authz/batch-evaluate:
    post:
      summary: Evaluate multiple authorization requests
      operationId: batchEvaluate
      tags:
        - Authorization
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchEvaluateRequest'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BatchEvaluateResponse'

  /authz/profile:
    get:
      summary: Get subject's authorization profile
      operationId: getSubjectProfile
      tags:
        - Authorization
      parameters:
        - name: org
          in: query
          required: false
          schema:
            type: string
          description: Organization name (optional, omit for global profile)
        - name: project
          in: query
          required: false
          schema:
            type: string
          description: Project name (optional)
        - name: component
          in: query
          required: false
          schema:
            type: string
          description: Component name (optional)
        - name: ou
          in: query
          required: false
          schema:
            type: array
            items:
              type: string
          description: Organization units (optional)
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/APIResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UserCapabilitiesResponse'
