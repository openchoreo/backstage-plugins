# Local Development Configuration for Backstage with Kind Cluster
#
# This file contains pre-configured values for running Backstage locally
# (at localhost:3000 and localhost:7007) while connecting to services
# running in a Kind cluster (*.openchoreo.localhost).
#
# Quick Start:
#   1. Copy this file: cp app-config.local.yaml.example app-config.local.yaml
#   2. Start Backstage: yarn start
#   3. Access at: http://localhost:3000
#
# Note: app-config.local.yaml is gitignored and won't affect production builds.
# The Docker build only uses app-config.production.yaml.

app:
  # Backstage frontend URL (local development)
  baseUrl: http://localhost:3000

backend:
  # Backstage backend URL (local development)
  baseUrl: http://localhost:7007

  # CORS configuration for local development
  cors:
    origin: http://localhost:3000
    methods: [GET, HEAD, PATCH, POST, PUT, DELETE]
    credentials: true

  # Database configuration (in-memory SQLite for local development)
  database:
    client: better-sqlite3
    connection: ':memory:'

# OpenChoreo API configuration (Kind cluster)
openchoreo:
  baseUrl: http://api.openchoreo.localhost:8080/api/v1
  # token: ""  # Optional: uncomment if you need API authentication
  # OPTIONAL: For large-scale local testing, enable incremental ingestion
  # incremental:
  #   burstLength: 16 # Duration of each burst of processing activity in seconds
  #   burstInterval: 8 # Interval between bursts of processing activity in seconds
  #   chunkSize: 512 # Number of items to fetch per API request
  #   restLength: 60 # Duration of rest periods between bursts in minutes

  # OAuth2 Client Credentials for background tasks (Catalog Entity Provider)
  # Required for the Catalog Provider to fetch organizations, projects, and components
  auth:
    clientId: openchoreo-backstage-client
    clientSecret: backstage-portal-secret
    tokenUrl: http://thunder.openchoreo.localhost:8080/oauth2/token

  # Feature flags (optional overrides)
  # All features are enabled by default. Uncomment to disable specific features:
  features:
    workflows:
      enabled: true    # Set to false to hide Workflows tab and build-related UI
    observability:
      enabled: true    # Set to false to hide Metrics, Traces, Runtime Logs tabs
    auth:
      enabled: true    # Set to false for guest mode (no OAuth login required)
    authz:
      enabled: true    # Set to false to hide Access Control sidebar and pages

# Thunder IDP configuration (Kind cluster)
thunder:
  baseUrl: http://thunder.openchoreo.localhost:8080

# OAuth authentication configuration (Kind cluster)
# The openchoreo-auth provider works with any OAuth2/OIDC-compliant identity provider
#
# Two configuration modes are supported:
# 1. OIDC Discovery (preferred): Set metadataUrl to auto-discover endpoints
# 2. Explicit URLs: Set authorizationUrl and tokenUrl directly
auth:
  environment: development
  providers:
    openchoreo-auth:
      development:
        # OAuth credentials from Kind cluster helm values
        # (see openchoreo/install/dev/openchoreo-values.yaml)
        clientId: openchoreo-backstage-client
        clientSecret: backstage-portal-secret

        # Option 1: OIDC Discovery (preferred) - uncomment to use
        # metadataUrl: http://thunder.openchoreo.localhost:8080/.well-known/openid-configuration

        # Option 2: Explicit URLs (for IDPs without discovery endpoint)
        authorizationUrl: http://thunder.openchoreo.localhost:8080/oauth2/authorize
        tokenUrl: http://thunder.openchoreo.localhost:8080/oauth2/token
        scope: 'openid profile email'

# GitHub integration (optional)
# Uncomment and add your personal access token if you need GitHub integration
# integrations:
#   github:
#     - host: github.com
#       token: YOUR_GITHUB_TOKEN_HERE
